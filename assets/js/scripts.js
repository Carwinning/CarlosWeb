const galleries = {
    Underdawg: {
        images: [
            '../assets/images/combat-robotics/Underdawg/1.jpg',
            '../assets/images/combat-robotics/Underdawg/2.jpg',
            '../assets/images/combat-robotics/Underdawg/3.jpg',
            '../assets/images/combat-robotics/Underdawg/4.jpg',
            '../assets/images/combat-robotics/Underdawg/5.jpg',
            '../assets/images/combat-robotics/Underdawg/6.jpg',
            '../assets/images/combat-robotics/Underdawg/7.jpg',
            '../assets/images/combat-robotics/Underdawg/8.jpg'
        ],
        description: 'Underdawg is a 3lb beetle combat robot and was my first project at MIT and the reason for my pursuit in mechanical engineering.' +
        ' The first version of the robot took most of my first semester to design as part of a group. Beyond that, each next iteration has been of my own design.' +
        ' Underdawg has competed at its current iteration at 2 competitions, Build Fight Fun! in July of 2025 and NHRL in Nov of 2025.' +
        ' Underdawg lost both of its matches at NHRL, but placed second at Build Fight Fun!'
    },
    Uppydawg: {
        images: [
            '../assets/images/combat-robotics/Uppydawg/1.jpg',
            '../assets/images/combat-robotics/Uppydawg/2.jpg',
            '../assets/images/combat-robotics/Uppydawg/3.jpg',
            '../assets/images/combat-robotics/Uppydawg/4.jpg',
            '../assets/images/combat-robotics/Uppydawg/5.jpg',
            '../assets/images/combat-robotics/Uppydawg/6.jpg',
            '../assets/images/combat-robotics/Uppydawg/7.jpg',
            '../assets/images/combat-robotics/Uppydawg/8.jpg',
            '../assets/images/combat-robotics/Uppydawg/9.jpg'
        ],
        description: 'Uppydawg is my second 1lb Plastic Antweight (Plant) combat robot made for a plant tournament at Northeastern University in the summer of 2025' +
        ' Uppydawg is a full body robot that lifts opponents by getting under them with its slopped body and pressing a hidden arm on the floor below it to lift its body and the body of other robots.' +
        ' This robot was a simple way to experiment with other weapon types in combat robotics and have fun while at it!'
    },
    DAYBREAK: {
        images: [
            '../assets/images/combat-robotics/DAYBREAK/1.jpeg',
            '../assets/images/combat-robotics/DAYBREAK/2.jpeg',
            '../assets/images/combat-robotics/DAYBREAK/3.jpeg',
            '../assets/images/combat-robotics/DAYBREAK/4.jpeg',
            '../assets/images/combat-robotics/DAYBREAK/5.jpeg',
            '../assets/images/combat-robotics/DAYBREAK/6.jpeg',
            '../assets/images/combat-robotics/DAYBREAK/7.jpeg',
            '../assets/images/combat-robotics/DAYBREAK/8.jpeg'
        ],
        description: 'DAYBREAK is a 30lb robot that was designed and built within the two weeks before its competition date.' +
        ' DAYBREAK was originally a flamethrower robot, but flamethrowers were banned at the NHRL competition, so I wanted to redesign DAYBREAK as a \'melty brain\' robot which spins its entire body rapidly to attack.' +
        ' Given the time constraint, I used an existing welded frame and electronics for DAYBREAK.' + 
        ' It was a fun experience to build a large bot in a short timeframe, though ultimately DAYBREAK was unable to compete as the drive system didn\'t have enough torque to spin DAYBREAK.'
    },
    Maxydawg: {
        images: [
            '../assets/images/combat-robotics/Maxydawg/1.jpeg',
            '../assets/images/combat-robotics/Maxydawg/2.jpeg',
            '../assets/images/combat-robotics/Maxydawg/3.jpeg',
            '../assets/images/combat-robotics/Maxydawg/4.jpeg',
            '../assets/images/combat-robotics/Maxydawg/5.jpeg',
            '../assets/images/combat-robotics/Maxydawg/6.jpeg',
            '../assets/images/combat-robotics/Maxydawg/7.jpeg',
            '../assets/images/combat-robotics/Maxydawg/8.jpeg'
        ],
        description: 'Maxydawg is a 1lb Full Combat Antweight robot that I designed and built over the course of 13 hours to compete against against a friend building his robot in the same timeframe.' +
        ' Maxydawg\'s horizontal spinning weapon is mounted a custom 3D printed \'hubmotor\'that mounts on a basic brushless motor.' +
        ' Maxydawg ended about 200g overweight, but regardless we fought five matches total until Maxydawg was too damaged to repair with the opposing bot winning with a score of 3-2.'
    },
    Lildawg: {
        images: [
            '../assets/images/combat-robotics/Lildawg/1.jpeg',
            '../assets/images/combat-robotics/Lildawg/2.jpeg',
            '../assets/images/combat-robotics/Lildawg/3.jpeg',
            '../assets/images/combat-robotics/Lildawg/4.jpeg'
        ],
        description: 'description' +
        ' Lildawg was my first 1lb Plastic Antweight (Plant) and first multi-bot combat robot.' +
        ' I built Lildawg originally to be single robot, but had no proper gauge of large it should be and ended up with a robot that was way underweight.' +
        ' Instead of redesigning Lildawg, I decided to build a second copy of the robot because a multi-bot sounded more fun!'
    },
    GlassFlowers: {
        images: [
            '../assets/images/creativejuice/GlassFlowers/1.jpeg',
            '../assets/images/creativejuice/GlassFlowers/2.jpeg',
            '../assets/images/creativejuice/GlassFlowers/3.jpeg',
            '../assets/images/creativejuice/GlassFlowers/4.jpeg',
            '../assets/images/creativejuice/GlassFlowers/5.jpeg'
        ],
        description: 'One of the new hobbies I picked up at MIT has been glass lampworking!' +
        ' I\'ve been making many flowers as I\'ve found them to be a great way to learn and practice techniques.' +
        ' Most of my flowers are the same basic design, but I\'m starting to experiment making other kinds!'
    },
    GlassCritters: {
        images: [
            '../assets/images/creativejuice/GlassCritters/1.jpeg',
            '../assets/images/creativejuice/GlassCritters/2.jpeg',
            '../assets/images/creativejuice/GlassCritters/3.jpeg'
        ],
        description: 'The reason I picked up glass lampworking was because I\'d loved to make a collection of insects and other small critters, but they have proven much harder than I had thought they\'d be' +
        ' I\'m currently focusing on making spiders over and over until I feel comfortable with the techniques involved.' +
        ' The legs especially have proven difficult to make, but I think I\'ll be able to move on to more complex designs soon!'
    },
    CreativeMisc: {
        images: [
            '../assets/images/creativejuice/Misc/1.jpeg',
            '../assets/images/creativejuice/Misc/2.jpeg',
            '../assets/images/creativejuice/Misc/3.jpeg',
            '../assets/images/creativejuice/Misc/4.jpeg'
        ],
        description: 'Here are some of the various random projects or gifts I\'ve made!'
    },
    SauceathonBot: {
        images: [
            '../assets/images/smartjuice/SauceathonBot/1.jpeg',
            '../assets/images/smartjuice/SauceathonBot/2.jpg',
            '../assets/images/smartjuice/SauceathonBot/3.jpeg'
        ],
        description: 'I participated at Sauceathon 2025 in Norwalk, Connecticut in a group with 5 others to build a first person view robot that would \'save children\' within an arena.' +
        ' We had a total of 24 hours to design and build the robot, we weren\'t told the final task until we had completed some subtasks first.' +
        ' Our robot was designed with the goal of completing a few high point tasks (saving \'high value\' children) rather than completing many low point tasks' + 
        ' Our robot failed to perform as we wished, but it was my first real hardware hackathon and I had a blast participating!'
    },
    StrobeDemo: {
        images: [
            '../assets/images/smartjuice/StrobeDemo/1.jpeg',
            '../assets/images/smartjuice/StrobeDemo/2.jpeg',
            '../assets/images/smartjuice/StrobeDemo/3.jpeg'
        ],
        description: 'These are some simple containers for an adjustable strobe light and turntable that I had designed.' +
        ' These were used as teaching materials in an extreme imaging class at MIT over the summer of 2025.'
    },
    Trident: {
        images: [
            '../assets/images/smartjuice/Trident/1.png',
            '../assets/images/smartjuice/Trident/2.jpeg',
            '../assets/images/smartjuice/Trident/3.png'
        ],
        description: 'Trident is a WIP robotic arm that will have a total of 3 diffrent kinds of gearboxes in it\s system; cycloidal, harmonic, and planetary.' +
        ' This is my first long-term personal project beyond combat robotics and classes that I am pursuing for the sake of learning new techniques.' +
        ' The arm is currently entirely 3D printed, but I would like to machine it out of metal in the future after having built a working 3D printed version.'
    }
    // ,
    // UnloadingShip: {
    //     images: [
    //         '../assets/images/smartjuice/UnloadingShip/1.jpeg',
    //         '../assets/images/smartjuice/UnloadingShip/2.jpeg',
    //         '../assets/images/smartjuice/UnloadingShip/3.jpeg',
    //         '../assets/images/smartjuice/UnloadingShip/4.png',
    //         '../assets/images/smartjuice/UnloadingShip/5.png',
    //         '../assets/images/smartjuice/UnloadingShip/6.jpeg',
    //         '../assets/images/smartjuice/UnloadingShip/7.jpeg',
    //         '../assets/images/smartjuice/UnloadingShip/8.jpeg',
    //         '../assets/images/smartjuice/UnloadingShip/9.jpeg',
    //     ],
    //     description: 'description' +
    //     ' ' +
    //     ' ' + 
    //     ' '
    // }
};

let currentGallery = null;
let currentIndex = 0;
// const IMAGES_PER_VIEW = 5;

function computeImagesPerView() {
    const modal = document.querySelector('.modal-content');
    const imagesDiv = document.getElementById('galleryImages');
    if (!modal || !imagesDiv) return 3;

    const gap = 16;
    const arrowReserve = 64 + 64;
    const modalStyle = getComputedStyle(modal);
    const paddingLeft = parseFloat(modalStyle.paddingLeft) || 0;
    const paddingRight = parseFloat(modalStyle.paddingRight) || 0;

    const availableWidth = Math.max(0, modal.clientWidth - paddingLeft - paddingRight - arrowReserve);

    const MAX_IMAGES = 5; 
    const MIN_PER_IMAGE = 120;
    const CAP_PER_IMAGE = 220;

    const fitByMin = Math.floor((availableWidth + gap) / (MIN_PER_IMAGE + gap));
    const fitByCap = Math.floor((availableWidth + gap) / (CAP_PER_IMAGE + gap));

    let perView = Math.min(MAX_IMAGES, Math.max(1, fitByMin || 1));

    if (fitByCap > 0 && perView > fitByCap) {
        perView = Math.min(perView, fitByCap);
    }

    perView = Math.min(MAX_IMAGES, Math.max(1, perView));
    return perView;
}

function ensureArrows() {
    const modal = document.querySelector('.modal-content');
    if (!modal) return;
    const oldLeft = modal.querySelector('.arrow.left');
    const oldRight = modal.querySelector('.arrow.right');
    if (oldLeft) oldLeft.remove();
    if (oldRight) oldRight.remove();

    const left = document.createElement('span');
    left.className = 'arrow left';
    left.setAttribute('role','button');
    left.setAttribute('aria-label','Previous');
    left.innerText = '◀';
    left.addEventListener('click', () => scrollGallery(-1));
    modal.appendChild(left);

    const right = document.createElement('span');
    right.className = 'arrow right';
    right.setAttribute('role','button');
    right.setAttribute('aria-label','Next');
    right.innerText = '▶';
    right.addEventListener('click', () => scrollGallery(1));
    modal.appendChild(right);
}

function openGallery(project) {
    currentGallery = galleries[project];
    if (!currentGallery) {
        console.warn('Gallery not found:', project);
        return;
    }
    currentIndex = 0;
    const titleEl = document.getElementById('galleryTitle');
    titleEl && (titleEl.textContent = project);

    const modalEl = document.getElementById('galleryModal');
    modalEl.style.display = 'flex';

    ensureArrows();

    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            updateGalleryModal();
        });
    });

    window.addEventListener('resize', updateGalleryModal);
}

function updateGalleryModal() {
    const imagesDiv = document.getElementById('galleryImages');
    const descDiv = document.getElementById('galleryDescription');
    const titleEl = document.getElementById('galleryTitle');
    if (!currentGallery || !imagesDiv) return;

    const perView = computeImagesPerView();

    const maxIndex = Math.max(0, currentGallery.images.length - perView);
    if (currentIndex > maxIndex) currentIndex = maxIndex;
    if (currentIndex < 0) currentIndex = 0;

    imagesDiv.innerHTML = '';

    const modal = document.querySelector('.modal-content');
    const modalStyle = modal ? getComputedStyle(modal) : null;
    const paddingLeft = modalStyle ? parseFloat(modalStyle.paddingLeft) || 0 : 0;
    const paddingRight = modalStyle ? parseFloat(modalStyle.paddingRight) || 0 : 0;
    const arrowReserve = 64 + 64;
    const availableWidth = Math.max(0, (modal ? modal.clientWidth : window.innerWidth) - paddingLeft - paddingRight - arrowReserve);
    const gap = 16;

    let perImageWidth = Math.floor((availableWidth - gap * (perView - 1)) / perView);
    perImageWidth = Math.max(80, Math.min(220, perImageWidth)); 
    
    for (let i = currentIndex; i < Math.min(currentIndex + perView, currentGallery.images.length); i++) {
        const img = document.createElement('img');
        img.src = currentGallery.images[i];
        img.alt = currentGallery.titles ? (currentGallery.titles[i] || '') : '';
        img.loading = 'lazy';
        img.style.maxWidth = perImageWidth + 'px';
        img.style.maxHeight = 'calc(60vh - 40px)';
        img.style.objectFit = 'cover';
        img.style.flex = '0 0 auto';
        imagesDiv.appendChild(img);
    }

    ensureArrows();

    titleEl && (titleEl.textContent = currentGallery.name || titleEl.textContent);
    descDiv && (descDiv.textContent = currentGallery.description || '');
}

function scrollGallery(direction) {
    if (!currentGallery) return;
    const step = computeImagesPerView();
    const maxIndex = Math.max(0, currentGallery.images.length - step);
    currentIndex += direction * step;
    if (currentIndex < 0) currentIndex = 0;
    if (currentIndex > maxIndex) currentIndex = maxIndex;
    updateGalleryModal();
}

function closeGallery() {
    document.getElementById('galleryModal').style.display = 'none';
    window.removeEventListener('resize', updateGalleryModal);
    const modalContent = document.querySelector('.modal-content');
    if (modalContent) {
        const l = modalContent.querySelector('.arrow.left');
        const r = modalContent.querySelector('.arrow.right');
        if (l) l.remove();
        if (r) r.remove();
    }
}